#cloud-config
autoinstall:
    version: 1
    interactive-sections: []

    locale: sv_SE.UTF-8
    keyboard:
        layout: se

    identity:
        hostname: iac-vm
        username: devuser
        password: "$6$bEAwD2jOuJWZgOA7$jt2gnvSQNCN6VesNSGtrKQMueISsHMDjFo76VsTbA7gzjeeQtb67kL8rM6qD8eXP1BFrzH8SBPJrkEWQgmhJV1"
    
    ssh:
        install-server: true
        authorized-keys:
            - ssh-ed25519 AAAAC3NzaC1lZDI1NTE5AAAAIPpGjgNzIoUmfzCWqm280mXtjvFB7CA+dJZdvVLQ9E45 marcus@DESKTOP-3FJCNJ2
            - ssh-ed25519 AAAAC3NzaC1lZDI1NTE5AAAAILFYRNgCcHA8tfpW5x6LYndQ2OW7D1VQCPngYt0VOgrz marcus@Marcus-Laptop
    
    storage:
        version: 1
        config:
            - type: disk
              id: disk0
              match:
                size: largest
              wipe: superblock-recursive
              ptable: gpt
              grub_device: true

            - type: partition
              id: partition0
              device: disk0
              size: -1

            - type: format
              id: format0
              volume: partition0
              fstype: ext4

            - type: mount
              device: format0
              path: /
    
    late-commands:
        - curtin in-target -- bash -c "echo 'devuser ALL=(ALL) NOPASSWD:ALL' > /etc/sudoers.d/devuser"
        - curtin in-target -- chmod 0440 /etc/sudoers.d/devuser


    packages:
        - python3
        - python3-apt
    
    updates: security